

# 高并发条件下消息队列的设计与实现

# 1.需求



|赛题简介：介绍整个赛题的实现目标、实用价值、涉及技术和整体要求|本赛题要求参赛选手自行设计并实现一种“消息队列”来解决商品营销活动场景中突发流量过大容易宕机的问题。要求不得使用成熟的消息队列产品（如：ActiveMQ、RabbitMQ、ZeroMQ、Kafka、RocketMQ、MetaMq、Apollo等），设计新颖，用户体验好，禁止抄袭。|
|:----|:----|
|赛题业务场景：描述赛题相关的真实企业业务背景。从真实场景中，适当简化或者提炼出适合比赛的赛题场景|企业新产品进行线上发布销售，利用营销活动引流时，短时间内用户请求过多，流量暴增导致系统挂掉及出现商品超卖等现象。为了解决这一问题，企业要求定制设计一种“消息队列”进行流量削峰，模拟真实营销活动场景和现实需求进行压力测试。|
|基本功能要求|根据对营销活动的前期调研，要求开发以下主要功能：<br>1.用户管理：包括用户注册和登录（用户登录无需验证码等），完善个人信息（如电话号码等），统计。<br>2.商品信息管理：商品增删改查，及定时发布抢购，商品信息包括商品名称、价格、图片、详情等。<br>3.营销活动管理：制定一种营销策略，某种商品定时发布抢购，根据订购顺序，第1-100名商品1折销售，第101-500名5折，第501-1000名8折，第1001名后商品原价销售。<br>4.订单管理：订单统计等，按照抢购顺序公示前1000名客户名称、手机号码（星号隐藏第4-7位）及对应折扣。<br>5.自行设计并实现一种消息队列，能够实现消息队列的基本功能，包括PRODUCER-COMSUMER、PUBLISH-SUBSCRIBE、API完备性、支持Java语言、单机呑吐量万级、消息丢失（接近0）、消息重复（可控制）、文档完备等。<br>6.模拟高并发场景，使用自行设计的消息队列解决营销活动中流量突发问题。<br>7.不得出现商品超卖现象。<br>8.使用JMeter工具进行压力测试，系统运行要求每秒至少支持10000并发，不宕机。|
|非功能性要求|无|
|实现条件：开发环境、实验平台、开发语言、数据库、编译器、涉及硬件等实现条件|1.运行环境：在单机搭载CentOS7.5服务器上测试，8 vCPU，Intel Xeon(Skylake) Platinum 8163、内存：16GB、硬盘：40GB。<br>注：选手项目并发测试时，可以采用阿里云【抢占式实例】测试，费用大约0.2元/时左右。<br>2.开发语言及环境不限，建议采用Java，JDK 1.8，nginx1.15，MySQL5.7.26，redis3.0等，提交作品时详细说明部署环境。<br>3. Jmeter测试方法<br>建议测试方式，安装apache-jmeter-5.2.1版本，线程数设置5万，Ramp-UP Period：10秒或更长一点。然后使用同步定时器控制下，设置每秒有1万次请求。就是这5万线程攒1万次请求，再攒1万次再请求。|
|测试数据或平台：提供给参赛者的测试环境和测试数据|无|
|开发所需设备及设备指标需求说明|普通PC机或笔记本；<br>操作系统：Windows7及以上|
|文档及其他要求|1、系统PPT介绍（包括项目介绍、项目技术、项目功能及截图、项目特点、项目测试环境、项目测试结果等）<br>2、需求规格说明书（包括项目场景及功能、项目所有技术详细介绍等）<br>3、产品页面原型设计（包括项目原型发布文件及源文件，工具可以采用Axure、Adobe XD等工具）<br>4、项目设计文档（包括项目介绍、系统总体设计、系统功能模块详细设计（类图、时序图），注：消息队列功能着重说明）<br>5、项目测试报告（包括JMeter工具进行压力测试配置说明，消息队列的基本功能测试结果）<br>6、项目部署资源及说明（包括可执行文件，如利用Java开发，涉及发布Jar包、启动Jar包时读取外部配置文件、数据库sql文件等，以及系统部署说明）<br>7、用户使用手册（包括项目功能介绍和用户操作）|
|各评分项及大致占比|1、需求规格说明书：10%<br>2、产品页面原型：5%<br>3、应用场景功能实现：30%（包括：用户管理、商品管理、营销活动、订单管理）<br>4、自行设计消息队列：50% （包括：实现了消息队列、消息队列详细设计文档、消息队列的基本功能测试报告、提供JMeter工具进行压力测试说明）<br>注：如果采用市场上已有消息队列实现了该功能，本模块最多5分。<br>5、用户使用手册：5%|
|初赛作品提交要求|1、系统PPT介绍<br>2、需求规格说明书<br>3、产品页面原型设计<br>4、项目设计文档<br>5、项目测试报告<br>6、项目部署资源节说明<br>7、用户使用手册<br>8、演示视频（7分钟之内）|

# 2.数据库设计

表名：  用户表 hb_user

|列名|数据类型|长度|主键|非空|自增|注释|
|:----|:----|:----|:----|:----|:----|:----|
|fk_user_id|varchar|20|Y|Y|    |用户id|
|username|varchar|20|    |    |    |    |
|password|varchar|20|    |    |    |    |
|sex|int|2|    |    |    |1:男  2:女|
|address|varchar|80|    |    |    |    |
|phone|varchar|11|    |    |    |    |
|nickname|varchar|50|    |    |    |昵称|
|avatar|varchar|255|    |    |    |头像|
|email|varchar|255|    |    |    |    |
|birthday|date|    |    |    |    |    |
|status|int|2|    |    |    |未激活:0 已激活:1|
|created_time|datetime|    |    |    |    |    |
|updated_time|datetime|    |    |    |    |    |
|sale|varchar|255|    |    |    |加密盐|
|money|double|16,2|    |    |    |    |

表名： 商品表 hb_good

|列名|数据类型|长度|主键|非空|自增|注释|
|:----|:----|:----|:----|:----|:----|:----|
|pk_good_id|varchar|20|Y|Y|    |    |
|goodname|varchar|255|    |    |    |    |
|describtion|varchar|255|    |    |    |    |
|price|double|16,2|    |    |    |    |
|image|varchar|255|    |    |    |    |
|status|int|2|    |    |    |未激活:0<br>已激活:1|
|creared_time|datetime|    |    |    |    |    |
|updated_time|datetime|    |    |    |    |    |
|type|varchar|255|    |    |    |    |
|count|int|8|    |    |    |总数|


表名：  订单表 hb_order

|列名|数据类型|长度|主键|非空|自增|注释|
|:----|:----|:----|:----|:----|:----|:----|
|pk_order_id|varchar|20|Y|Y|    |    |
|ordername|varchar|255|    |    |    |    |
|rank|int|8|    |    |    |订单排名|
|user_id|varchar|20|    |    |    |    |
|phone|varchar|11|    |    |    |    |
|||creared_timedatetime|    |    |    |    |
|||updated_timedatetime|    |    |    |    |


表名：  策略表  strategy

|列名|数据类型|长度|主键|非空|自增|注释|
|:----|:----|:----|:----|:----|:----|:----|
|pk_strategy_id|varchar|255|Y|Y|    |    |
|strategy_name|varchar|255|    |    |    |    |
|good_id|varchar|20|    |Y|    |    |
|rank_start|int|8|    |Y|    |起始范围|
|rank_end|int|8|    |Y|    |终止范围|
|discount|double|16,2|    |    |    |折扣 0-1之间|
|created_time|datetime|    |    |    |    |    |
|updated_time|datetime|    |    |    |    |    |


表名：  评论表 comment

|列名|数据类型|长度|主键|非空|自增|注释|
|:----|:----|:----|:----|:----|:----|:----|
|pk_comment_id|varchar|20|Y|Y|    |    |
|pk_good_id|varchar|20|    |    |    |    |
|content|varchar|255|    |    |    |    |
|created_time|datetime|    |    |    |    |    |
|updated_time|datetime|    |    |    |    |    |
|type|int|2|    |    |    |评论星级|







# 3.功能

## 3.1基本功能

* 用户管理
* 商品信息管理
* 营销活动管理
* 订单管理
## 3.2核心功能

* 消息队列设置
* 高并发场景模拟


项目启动顺序：user seckill content mq